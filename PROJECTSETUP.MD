# MicroSOC Command Center - Complete File Structure

## Project Overview
- **Teammate 1**: Frontend (Next.js) - Admin pages, login, signup, landing pages âœ…
- **Teammate 2**: Attack logs & incidents generator (JSON format) - Will provide data
- **Your Task**: Real-time admin dashboard with Socket.io + Redis + Geo-location

---

## Complete File Structure

```
microsoc-command-centre/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (auth)/                          # Auth routes (Teammate 1)
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                  # Login page
â”‚   â”‚   â”‚   â””â”€â”€ sign-up/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx                 # Analyst signup
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/                           # Admin routes (Teammate 1 + Your work)
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                 # â­ Admin Dashboard (Real-time) - TO CREATE
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/              # Dashboard components
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AttackMap.tsx        # â­ Geo-location map component
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AttackStats.tsx      # â­ Attack statistics cards
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ IPTable.tsx          # â­ Top IPs with counts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RealTimeLogs.tsx     # â­ Live log stream
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AttackCharts.tsx     # â­ Charts (bar, line, pie)
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ IncidentList.tsx     # â­ Active incidents list
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ analysts/                     # Admin analyst management (Teammate 1)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                 # List all analysts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx              # Analyst details
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ incidents/                    # Admin incident management
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx                 # All incidents view
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ analyst/                         # Analyst routes (Your work)
â”‚   â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx                  # âœ… Analyst dashboard (already created)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analysts/                # Analyst management APIs
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ approve/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts         # âœ… Approve analyst
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pending/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts         # âœ… Get pending analysts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ reject/
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts         # âœ… Reject analyst
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dashboard/               # â­ Admin dashboard APIs - TO CREATE
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ realtime/
â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts         # â­ Real-time data endpoint
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ geo/
â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts         # â­ Geo-location data
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ip-stats/
â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts         # â­ IP-based statistics
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ summary/
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts         # â­ Dashboard summary stats
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                        # Auth APIs (Teammate 1)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [...nextauth]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ options.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sign-up/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/                   # Dashboard APIs (Your work)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ attacks/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts            # âœ… Attack trends
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ips/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts            # âœ… Top IPs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dns/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts            # âœ… DNS queries
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ injections/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts            # âœ… Injection data
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ exfiltration/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts            # âœ… Exfiltration data
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ incidents/                  # Incident APIs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ assign/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ update/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ logs/                       # Log ingestion (Your work)
â”‚   â”‚   â”‚       â””â”€â”€ ingest/
â”‚   â”‚   â”‚           â””â”€â”€ route.ts            # âœ… Accept JSON logs from Teammate 2
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ socket/                         # â­ Socket.io API route - TO CREATE
â”‚   â”‚   â”‚   â””â”€â”€ route.ts                    # â­ Socket.io handler for Next.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx                        # Landing page (Teammate 1)
â”‚   â”‚
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ dbConnect.ts                    # âœ… MongoDB connection
â”‚   â”‚   â”œâ”€â”€ redis.ts                        # âœ… Redis client (needs enhancement)
â”‚   â”‚   â”œâ”€â”€ socket.ts                       # â­ Socket.io server setup - TO ENHANCE
â”‚   â”‚   â”œâ”€â”€ auth.ts                         # âœ… Auth utilities
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ ipInfo.ts                   # â­ Geo-location utility - TO CREATE
â”‚   â”‚       â””â”€â”€ rateLimit.ts                # âœ… Rate limiting
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.ts                         # âœ… User model
â”‚   â”‚   â”œâ”€â”€ Log.ts                          # âœ… Log model (updated)
â”‚   â”‚   â”œâ”€â”€ Incident.ts                     # âœ… Incident model
â”‚   â”‚   â”œâ”€â”€ Rule.ts                         # âœ… Rule model
â”‚   â”‚   â””â”€â”€ Ticket.ts                       # âœ… Ticket model
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                           # â­ Business logic layer - TO CREATE
â”‚   â”‚   â”œâ”€â”€ logProcessor.ts                 # â­ Process incoming logs
â”‚   â”‚   â”œâ”€â”€ geoService.ts                   # â­ Geo-location service
â”‚   â”‚   â”œâ”€â”€ ipAggregator.ts                 # â­ IP-based aggregation
â”‚   â”‚   â”œâ”€â”€ incidentCreator.ts              # â­ Auto-create incidents from logs
â”‚   â”‚   â””â”€â”€ realtimePublisher.ts            # â­ Redis pub/sub publisher
â”‚   â”‚
â”‚   â”œâ”€â”€ socket/                             # â­ Socket.io handlers - TO CREATE
â”‚   â”‚   â”œâ”€â”€ index.ts                        # âœ… Basic setup (needs enhancement)
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ attackLogs.ts               # â­ Handle attack log events
â”‚   â”‚   â”‚   â”œâ”€â”€ incidents.ts                # â­ Handle incident events
â”‚   â”‚   â”‚   â””â”€â”€ adminDashboard.ts            # â­ Admin dashboard events
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â””â”€â”€ auth.ts                     # â­ Socket.io auth middleware
â”‚   â”‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ api-response.ts                 # âœ… API response types
â”‚   â”‚   â”œâ”€â”€ incident.ts                     # âœ… Incident types
â”‚   â”‚   â”œâ”€â”€ log.ts                          # âœ… Log types
â”‚   â”‚   â”œâ”€â”€ user.ts                         # âœ… User types
â”‚   â”‚   â””â”€â”€ dashboard.ts                    # â­ Dashboard types - TO CREATE
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # âœ… Constants
â”‚   â”‚   â””â”€â”€ logger.ts                      # âœ… Logger utility
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts                       # âœ… Route protection
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ (static assets)
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## Key Files to Create/Enhance

### ğŸ”´ HIGH PRIORITY - Real-time Admin Dashboard

#### 1. **Admin Dashboard Page**
```
src/app/admin/dashboard/page.tsx
```
- Main admin dashboard with real-time updates
- Uses Socket.io client for live data
- Displays: Attack map, IP stats, live logs, charts

#### 2. **Socket.io Server Setup**
```
src/lib/socket.ts (enhance existing)
src/app/api/socket/route.ts (new)
```
- Initialize Socket.io server
- Handle Redis pub/sub subscriptions
- Broadcast to connected admin clients

#### 3. **Log Ingestion with Real-time Publishing**
```
src/app/api/logs/ingest/route.ts (enhance existing)
src/services/realtimePublisher.ts (new)
```
- Accept JSON from Teammate 2
- Store in MongoDB
- Publish to Redis channel
- Trigger Socket.io broadcast

#### 4. **Geo-location Service**
```
src/utils/ipInfo.ts (new)
src/services/geoService.ts (new)
src/app/api/admin/dashboard/geo/route.ts (new)
```
- Get IP geo-location (use free API like ipapi.co or ip-api.com)
- Cache in Redis
- Return lat/lng for map visualization

#### 5. **IP Aggregation Service**
```
src/services/ipAggregator.ts (new)
src/app/api/admin/dashboard/ip-stats/route.ts (new)
```
- Count attacks per IP
- Track attack types per IP
- Calculate risk scores

#### 6. **Dashboard Components**
```
src/app/admin/dashboard/components/
â”œâ”€â”€ AttackMap.tsx          # World map with attack markers
â”œâ”€â”€ AttackStats.tsx       # Summary cards (total attacks, blocked, etc.)
â”œâ”€â”€ IPTable.tsx            # Top IPs with counts and geo info
â”œâ”€â”€ RealTimeLogs.tsx       # Live scrolling log feed
â”œâ”€â”€ AttackCharts.tsx       # Bar/line/pie charts
â””â”€â”€ IncidentList.tsx       # Active incidents table
```

---

## Data Flow Architecture

```
Teammate 2 (JSON logs)
    â†“
POST /api/logs/ingest
    â†“
1. Store in MongoDB (Log model)
2. Get Geo-location (cache in Redis)
3. Aggregate IP stats (update Redis)
4. Publish to Redis channel: "soc:attack_logs"
    â†“
Socket.io Server (subscribes to Redis)
    â†“
Broadcast to connected admin clients
    â†“
Admin Dashboard (Socket.io client)
    â†“
Update UI in real-time
```

---

## Redis Data Structure

```javascript
// Attack log channel
REDIS_CHANNELS.ATTACK_LOGS = "soc:attack_logs"

// Cache keys
"ip:geo:{ip}"              // Geo-location cache (24h TTL)
"ip:stats:{ip}"            // IP statistics (1h TTL)
"dashboard:summary"         // Dashboard summary (5min TTL)
"ip:count:{ip}"            // Attack count per IP (1h TTL)
```

---

## Socket.io Events

### Client â†’ Server
- `admin:join` - Admin joins dashboard room
- `admin:leave` - Admin leaves dashboard room

### Server â†’ Client
- `attack:new` - New attack log received
- `attack:batch` - Batch of new attacks
- `incident:created` - New incident created
- `incident:updated` - Incident status updated
- `stats:update` - Dashboard statistics updated
- `ip:update` - IP statistics updated

---

## Implementation Order

### Phase 1: Core Infrastructure
1. âœ… Log model (already done)
2. âœ… Log ingestion API (already done)
3. â­ Enhance Redis utilities
4. â­ Setup Socket.io server
5. â­ Create geo-location service

### Phase 2: Real-time Pipeline
1. â­ Enhance log ingestion to publish to Redis
2. â­ Socket.io Redis subscriber
3. â­ IP aggregation service
4. â­ Dashboard summary service

### Phase 3: Admin Dashboard
1. â­ Admin dashboard page
2. â­ Dashboard components
3. â­ Socket.io client integration
4. â­ Real-time updates

### Phase 4: Geo-location & Maps
1. â­ Geo-location API integration
2. â­ Map component (use react-simple-maps or leaflet)
3. â­ IP markers on map

---

## Environment Variables Needed

```env
# Existing
MONGODB_URI=...
REDIS_URL=redis://localhost:6379
JWT_SECRET=...

# New
GEO_API_KEY=...              # Optional (for paid geo APIs)
GEO_API_URL=https://ipapi.co  # Free geo API
SOCKET_PORT=3001              # Optional (if separate socket server)
```

---

## Dependencies to Install

```bash
npm install socket.io-client          # Client-side Socket.io
npm install react-simple-maps         # For world map
npm install @react-leaflet/core       # Alternative map library
npm install @react-leaflet/leaflet    # Leaflet maps
leaflet                                # Map tiles
```

---

## Next Steps

1. **Start with Socket.io setup** - Create server and client connection
2. **Enhance log ingestion** - Add Redis publishing
3. **Create geo-location service** - IP to location mapping
4. **Build admin dashboard** - Main page with components
5. **Add real-time updates** - Connect Socket.io to dashboard

---

## Notes

- âœ… = Already implemented
- â­ = Needs to be created/enhanced
- Admin dashboard should be accessible at `/admin/dashboard`
- Real-time updates should work without page refresh
- Geo-location should be cached to avoid API rate limits
- IP statistics should update in real-time as new logs arrive

